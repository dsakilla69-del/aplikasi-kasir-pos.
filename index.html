<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kasir Toko Tanaman</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif; margin: 0; padding: 10px; background-color: #f0f2f5; color: #333; }
    .container { max-width: 500px; margin: 0 auto; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin: 15px 0; }
    h2, h3 { color: #1a1a1a; margin-top: 0; }
    input, select, button { padding: 12px 15px; margin: 8px 0; width: 100%; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
    button { background-color: #28a745; color: white; font-weight: bold; border: none; cursor: pointer; transition: background-color 0.2s; }
    button:hover { background-color: #218838; }
    button:disabled { background-color: #aaa; cursor: not-allowed; }
    .hidden { display: none; }
    #loader, #reportLoader { text-align: center; padding: 20px; }
    #userInfo { display: flex; justify-content: space-between; align-items: center; color: #555; margin-bottom: 10px; font-size: 14px;}
    #userInfo a { font-weight:bold; color:#dc3545; text-decoration:none; font-size: 12px; }
    .nav { display: flex; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-radius: 12px; margin: 0 auto; padding: 5px; }
    .nav-button { flex: 1; padding: 15px; text-align: center; background: none; border: none; font-size: 16px; font-weight: bold; color: #555; cursor: pointer; border-radius: 8px; }
    .nav-button.active { background: #28a745; color: #fff; }
    .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; }
    .product-card { border: 1px solid #eee; border-radius: 8px; overflow: hidden; text-align: center; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); padding-bottom: 10px; }
    .product-card img { width: 100%; height: 100px; object-fit: cover; }
    .product-card p { margin: 8px 5px; font-size: 14px; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; }
    .cart-item div:first-child { flex-grow: 1; }
    .btn-small { padding: 5px 10px; font-size: 12px; width: auto; background-color: #007bff; margin-top: 5px;}
    .btn-remove { background: none; border: none; color: #dc3545; font-size: 20px; cursor: pointer; padding: 5px; width: auto; }
    .total-section { margin-top: 15px; font-weight: bold; font-size: 1.1em; }
    .total-section div { display: flex; justify-content: space-between; padding: 5px 0; }
    .discount-applied { color: #28a745; }
    #btnTerapkanDiskon { background-color: #ffc107; color: #333; }
    #btnTerapkanDiskon.disabled { background-color: #aaa; color: #fff; }
    #btnSelesaikanTransaksi { background-color: #007bff; }
    .payment-options label { display: block; margin: 10px 0; }
    .admin-toggle { display: flex; align-items: center; justify-content: flex-end; margin-bottom: 15px; gap: 10px; }
    .admin-toggle label { font-size: 14px; color: #555; }
    .admin-toggle input { width: auto; }
    .product-admin-info { margin-top: 8px; font-size: 11px; color: #6c757d; background-color: #f8f9fa; padding: 5px; border-radius: 4px; text-align: left; margin: 5px; }
    .product-admin-info strong { color: #007bff; }
    .category-filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .category-btn { padding: 8px 15px; font-size: 14px; background-color: #e9ecef; color: #495057; border-radius: 20px; width: auto; }
    .category-btn.active { background-color: #007bff; color: white; }
    .pagination-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
    .pagination-controls button { width: auto; padding: 8px 15px; font-size: 14px; }
    .pagination-controls span { font-weight: bold; font-size: 14px; }
    .report-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center; }
    .report-card { background: #f8f9fa; padding: 20px; border-radius: 8px; }
    .report-card h4 { margin: 0 0 10px 0; color: #555; font-size: 14px; }
    .report-card p { margin: 0; font-size: 22px; font-weight: bold; color: #1a1a1a; }
    #strukArea { display: none; }
    @media print {
      body * { visibility: hidden; }
      #strukArea, #strukArea * { visibility: visible; }
      #strukArea { position: absolute; left: 0; top: 0; width: 100%; max-width: 58mm; font-family: 'Courier New', Courier, monospace; line-height: 1.4; font-size: 10pt; }
      #strukArea h3 { text-align: center; margin: 0; font-size: 12pt; }
      #strukArea p { margin: 2px 0; }
      #strukArea table { width: 100%; border-collapse: collapse; margin-top: 5px; }
      #strukArea td { text-align: left; padding: 1px 0; vertical-align: top; }
      #strukArea .total-line td { border-top: 1px dashed #000; padding-top: 5px; }
      #strukArea .footer { text-align: center; margin-top: 10px; font-size: 9pt; }
    }
  </style>
</head>
<body>
  <div class="container" id="loginPage">
    <div class="card">
      <h2>Login Kasir</h2>
      <input type="email" id="emailInput" placeholder="Email (contoh: kasir@tokotanaman.com)">
      <button onclick="login()">Masuk</button>
    </div>
  </div>

  <div id="appContainer" class="hidden">
    <div class="container">
      <p id="userInfo"></p>
      <div class="nav">
        <button class="nav-button active" id="navKasir" onclick="tampilkanHalaman('pos')">Kasir</button>
        <button class="nav-button" id="navLaporan" onclick="tampilkanHalaman('laporan')">Laporan</button>
      </div>
    </div>
    
    <div id="posPage">
      <div class="container">
        <div id="loader">Memuat produk...</div>
        <div id="mainContent" class="hidden">
          <div class="card">
            <h3>Pilih Produk</h3>
            <div class="admin-toggle">
              <label for="toggleInfoModal">Tampilkan Info Modal</label>
              <input type="checkbox" id="toggleInfoModal" onchange="toggleInfoModalView()">
            </div>
            <div class="category-filters" id="categoryFilters"></div>
            <input type="text" id="searchInput" placeholder="Cari tanaman..." onkeyup="updateProductView()">
            <div class="product-grid" id="produkList"></div>
            <div class="pagination-controls hidden" id="paginationControls">
              <button id="prevPageBtn" onclick="changePage(-1)">&laquo; Sebelumnya</button>
              <span id="pageInfo"></span>
              <button id="nextPageBtn" onclick="changePage(1)">Berikutnya &raquo;</button>
            </div>
          </div>
          <div class="card">
            <h3>Item Manual</h3>
            <input type="text" id="manualItemName" placeholder="Nama Item (cth: Biaya Antar)">
            <input type="number" id="manualItemPrice" placeholder="Harga">
            <button onclick="tambahItemManual()">+ Tambah Item</button>
          </div>
          <div class="card" id="keranjangCard">
            <h3>Keranjang Belanja</h3>
            <input type="text" id="memberId" placeholder="ID Member (No. HP)">
            <button id="btnTerapkanDiskon" onclick="terapkanDiskon()">Terapkan Diskon</button>
            <div id="cartItems">Tidak ada item.</div>
            <div class="total-section">
              <div id="subtotalLine"><span>Subtotal:</span> <span id="subtotalHarga">Rp 0</span></div>
              <div id="diskonLine" class="hidden"><span>Penghematan Member:</span> <span id="nilaiDiskon" class="discount-applied">Rp 0</span></div>
              <hr>
              <div><span>Total:</span> <span id="totalHarga">Rp 0</span></div>
            </div>
            <button id="btnSelesaikanTransaksi" onclick="tampilkanPembayaran()">Lanjut ke Pembayaran</button>
          </div>
          <div class="card hidden" id="paymentCard">
            <h3>Detail Pembayaran</h3>
            <h4>Total Tagihan: <span id="paymentTotalTagihan">Rp 0</span></h4>
            <div class="payment-options">
              <label><input type="radio" name="metodePembayaran" value="Tunai" onchange="togglePaymentDetails()" checked> Tunai</label>
              <label><input type="radio" name="metodePembayaran" value="Non-Tunai" onchange="togglePaymentDetails()"> Non-Tunai</label>
            </div>
            <div id="tunaiDetails">
              <input type="number" id="uangDiterima" placeholder="Uang Diterima (Rp)" oninput="hitungKembalian()">
              <p>Kembalian: <strong id="kembalian">Rp 0</strong></p>
            </div>
            <div id="nonTunaiDetails" class="hidden">
              <select id="jenisNonTunai">
                <option value="QRIS">QRIS</option> <option value="Shopee">Shopee</option> <option value="Tokopedia">Tokopedia</option> <option value="Transfer">Transfer</option>
              </select>
            </div>
            <button id="btnKonfirmasiPembayaran" onclick="selesaikanTransaksi()">Konfirmasi & Simpan</button>
            <button style="background-color: #6c757d;" onclick="batalPembayaran()">Kembali ke Keranjang</button>
          </div>
          <div class="card hidden" id="postTransactionCard">
            <h4>Transaksi Berhasil!</h4>
            <button id="btnCetakStruk" onclick="cetakStruk()">Cetak Struk</button>
            <button style="background-color: #007bff;" onclick="transaksiBaru()">Mulai Transaksi Baru</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="container hidden" id="laporanPage">
       <div class="card">
        <h3>Laporan Penjualan Hari Ini (<span id="reportCabang"></span>)</h3>
        <p><small>(Data diperbarui setiap ada transaksi baru)</small></p>
        <div id="reportLoader">Memuat laporan...</div>
        <div id="reportContent" class="hidden">
          <div class="report-summary">
            <div class="report-card">
              <h4>Total Penjualan</h4>
              <p>Rp <span id="reportTotalPenjualan">0</span></p>
            </div>
            <div class="report-card">
              <h4>Jumlah Transaksi</h4>
              <p id="reportJumlahTransaksi">0</p>
            </div>
            <div class="report-card">
              <h4>Penjualan Tunai</h4>
              <p>Rp <span id="reportTotalTunai">0</span></p>
            </div>
            <div class="report-card">
              <h4>Penjualan Non-Tunai</h4>
              <p>Rp <span id="reportTotalNonTunai">0</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="strukArea"><!-- Konten Struk akan diisi oleh Javascript --></div>

  <script>
    let semuaProduk = [], keranjang = [], lastTransactionId = null, currentUser = null;
    let currentPage = 1;
    const itemsPerPage = 12;
    let isMemberActive = false;

    window.onload = function() { 
      try {
        const savedUser = localStorage.getItem('currentUser'); 
        if (savedUser) { 
          setupApp(JSON.parse(savedUser)); 
        } 
      } catch (e) {
        console.error("Gagal memuat sesi:", e);
        localStorage.removeItem('currentUser');
      }
    };
    
    function logout() { 
      if (confirm("Apakah Anda yakin ingin logout?")) {
        localStorage.removeItem('currentUser');
        location.reload();
      } 
    }

    function setupApp(user) { 
      currentUser = user; 
      document.getElementById('userInfo').innerHTML = `<span>Kasir: ${currentUser.email} | Cabang: ${currentUser.cabang}</span> <a href="#" onclick="logout(); return false;">Logout</a>`; 
      document.getElementById('loginPage').classList.add('hidden'); 
      document.getElementById('appContainer').classList.remove('hidden'); 
      muatProduk(); 
    }
    
    function hasilLogin(res) { 
      console.log("Respons dari server:", res);
      if (res && res.success) { 
        localStorage.setItem('currentUser', JSON.stringify(res.user)); 
        setupApp(res.user); 
      } else { 
        alert((res && res.message) || 'Login gagal. Respons tidak valid dari server.'); 
      } 
    }
    
    // FUNGSI INTI YANG DIPERBAIKI (HARDENING)
    function tampilkanProduk(data) {
        if (!data || !Array.isArray(data)) {
            alert("Gagal memuat data produk atau format data salah. Cek sheet 'Produk'.");
            document.getElementById('loader').textContent = "Error: Data Produk Tidak Valid.";
            return;
        }
        semuaProduk = data; 
        const container = document.getElementById('produkList');
        const filterContainer = document.getElementById('categoryFilters');
        container.innerHTML = '';
        filterContainer.innerHTML = '';
        
        const categories = ['Semua', ...new Set(data.map(p => p && p['Jenis']).filter(Boolean))];
        
        categories.forEach(category => {
          const btn = document.createElement('button');
          btn.className = 'category-btn';
          btn.textContent = category;
          if (category === 'Semua') btn.classList.add('active');
          btn.onclick = () => filterByCategory(category);
          filterContainer.appendChild(btn);
        });

        data.forEach((p, index) => { 
            try {
                if (!p || !p['Nama Produk']) {
                    console.warn(`Data produk di baris spreadsheet ${index + 2} tidak valid (nama kosong), dilewati.`);
                    return; 
                }

                const div = document.createElement('div'); 
                div.className = 'product-card';
                div.dataset.jenis = p['Jenis'] || ''; 
                div.dataset.index = index;
                div.style.display = 'none';
                
                const hargaJual = parseInt(p['Harga Jual']) || 0;
                const hargaMember = parseInt(p['Harga Member']) || 0;
                const hargaModal = parseInt(p['Harga Modal']) || 0;
                const supplier = p['Supplier'] || 'Tidak ada'; 

                div.innerHTML = `
                    <img src="${p['Foto URL'] || 'https://placehold.co/100x100/e2e8f0/e2e8f0?text=x'}" alt="${p['Nama Produk']}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/e2e8f0/e2e8f0?text=x';">
                    <p>${p['Nama Produk']} (${p['Ukuran/Variasi'] || ''})</p>
                    <p><strong>Rp ${hargaJual.toLocaleString()}</strong></p>
                    <div class="product-admin-info hidden">
                        <small>Modal: Rp ${hargaModal.toLocaleString()}<br>
                        <strong>Member: Rp ${hargaMember.toLocaleString()}</strong><br>
                        Supplier: ${supplier}</small> 
                    </div>
                    <button class="btn-small" onclick="tambahKeKeranjang(${index})">+ Keranjang</button>
                `; 
                container.appendChild(div); 
            } catch (e) {
                console.error(`Error saat memproses produk di baris spreadsheet ${index + 2}:`, p, e);
            }
        }); 
        
        document.getElementById('loader').classList.add('hidden'); 
        document.getElementById('mainContent').classList.remove('hidden'); 
        toggleInfoModalView();
        updateProductView();
    }
    
    function hasilCekMember(res) { const btn = document.getElementById('btnTerapkanDiskon'); if (res.success) { alert(`Harga member untuk ${res.nama} berhasil diterapkan.`); isMemberActive = true; btn.textContent = 'Harga Member Aktif'; btn.classList.add('disabled'); btn.disabled = true; } else { alert(res.message); isMemberActive = false; btn.textContent = 'Terapkan Diskon'; btn.disabled = false; } updateKeranjang(); }
    function kalkulasiTotal() { let subtotal = 0; let subtotalNormal = 0; keranjang.forEach(item => { const hargaJual = parseInt(item.produk['Harga Jual']) || 0; const hargaMember = parseInt(item.produk['Harga Member']) || 0; const hargaEfektif = (isMemberActive && hargaMember > 0 && hargaMember < hargaJual) ? hargaMember : hargaJual; subtotal += item.qty * hargaEfektif; subtotalNormal += item.qty * hargaJual; }); document.getElementById('subtotalHarga').textContent = `Rp ${subtotalNormal.toLocaleString()}`; document.getElementById('subtotalLine').classList.toggle('hidden', keranjang.length === 0); const penghematan = subtotalNormal - subtotal; if (isMemberActive && penghematan > 0) { document.getElementById('nilaiDiskon').textContent = `- Rp ${penghematan.toLocaleString()}`; document.getElementById('diskonLine').classList.remove('hidden'); } else { document.getElementById('diskonLine').classList.add('hidden'); } document.getElementById('totalHarga').textContent = `Rp ${subtotal.toLocaleString()}`; return { totalAkhir: subtotal, totalHemat: penghematan }; }
    function selesaikanTransaksi() { const metode = document.querySelector('input[name="metodePembayaran"]:checked').value; let detailMetode = (metode === 'Non-Tunai') ? document.getElementById('jenisNonTunai').value : ''; const totalInfo = kalkulasiTotal(); const dataTransaksi = { items: keranjang.map(item => { const hargaJual = parseInt(item.produk['Harga Jual']) || 0; const hargaMember = parseInt(item.produk['Harga Member']) || 0; const hargaAkhirSatuan = (isMemberActive && hargaMember > 0 && hargaMember < hargaJual) ? hargaMember : hargaJual; return { produk: item.produk, qty: item.qty, hargaAkhirSatuan: hargaAkhirSatuan }; }), memberId: document.getElementById('memberId').value, metodePembayaran: metode, detailMetode: detailMetode, diskonJumlah: totalInfo.totalHemat, totalAkhir: totalInfo.totalAkhir, timestamp: new Date().toISOString(), cabang: currentUser.cabang }; const btnKonfirmasi = document.getElementById('btnKonfirmasiPembayaran'); btnKonfirmasi.disabled = true; btnKonfirmasi.textContent = 'Menyimpan...'; google.script.run.withSuccessHandler(onTransaksiSuccess).withFailureHandler(onTransaksiFailure).simpanTransaksi(dataTransaksi); }
    function resetKeranjang() { keranjang = []; isMemberActive = false; document.getElementById('memberId').value = ''; const btnDiskon = document.getElementById('btnTerapkanDiskon'); btnDiskon.textContent = 'Terapkan Diskon'; btnDiskon.disabled = false; btnDiskon.classList.remove('disabled'); updateKeranjang(); }
    function tampilkanHalaman(halaman) { const posPage = document.getElementById('posPage'); const laporanPage = document.getElementById('laporanPage'); const navKasir = document.getElementById('navKasir'); const navLaporan = document.getElementById('navLaporan'); if (halaman === 'laporan') { posPage.classList.add('hidden'); laporanPage.classList.remove('hidden'); navKasir.classList.remove('active'); navLaporan.classList.add('active'); document.getElementById('reportCabang').textContent = currentUser.cabang; muatLaporan(); } else { laporanPage.classList.add('hidden'); posPage.classList.remove('hidden'); navLaporan.classList.remove('active'); navKasir.classList.add('active'); } }
    function muatLaporan() { if (!currentUser) return; document.getElementById('reportLoader').classList.remove('hidden'); document.getElementById('reportContent').classList.add('hidden'); google.script.run.withSuccessHandler(tampilkanDataLaporan).withFailureHandler(gagalMuatLaporan).getLaporanHarian(currentUser.cabang); }
    function tampilkanDataLaporan(data) { if (data.error) { gagalMuatLaporan(data.error); return; } document.getElementById('reportTotalPenjualan').textContent = data.totalPenjualan.toLocaleString(); document.getElementById('reportJumlahTransaksi').textContent = data.jumlahTransaksi; document.getElementById('reportTotalTunai').textContent = data.totalTunai.toLocaleString(); document.getElementById('reportTotalNonTunai').textContent = data.totalNonTunai.toLocaleString(); document.getElementById('reportLoader').classList.add('hidden'); document.getElementById('reportContent').classList.remove('hidden'); }
    function gagalMuatLaporan(error) { const loader = document.getElementById('reportLoader'); loader.textContent = 'Gagal memuat laporan: ' + error.toString(); }
    function toggleInfoModalView() { const isChecked = document.getElementById('toggleInfoModal').checked; const adminInfoElements = document.querySelectorAll('.product-admin-info'); adminInfoElements.forEach(el => { el.classList.toggle('hidden', !isChecked); }); }
    function login() { const email = document.getElementById('emailInput').value; if (!email) { alert('Email tidak boleh kosong.'); return; } google.script.run.withSuccessHandler(hasilLogin).withFailureHandler(() => alert('Gagal terhubung ke server.')).cekLogin(email); }
    function muatProduk() { google.script.run.withSuccessHandler(tampilkanProduk).withFailureHandler(() => alert('Gagal memuat produk.')).getProduk(); }
    function tambahKeKeranjang(index) { const produk = semuaProduk[index]; const itemAda = keranjang.find(item => item.produk['ID Produk'] === produk['ID Produk'] && item.produk['Ukuran/Variasi'] === produk['Ukuran/Variasi']); if (itemAda) { itemAda.qty++; } else { keranjang.push({ produk: produk, qty: 1, type: 'produk' }); } updateKeranjang(); }
    function tambahItemManual() { const name = document.getElementById('manualItemName').value; const price = parseInt(document.getElementById('manualItemPrice').value); if (name && price > 0) { const manualProduct = { 'ID Produk': 'MANUAL-' + Date.now(), 'Nama Produk': name, 'Ukuran/Variasi': 'Custom', 'Harga Jual': price, 'Harga Member': price, 'Harga Modal': 0, 'Supplier': 'Internal' }; keranjang.push({ produk: manualProduct, qty: 1, type: 'manual' }); updateKeranjang(); document.getElementById('manualItemName').value = ''; document.getElementById('manualItemPrice').value = ''; } else { alert('Nama item dan harga manual harus diisi.'); } }
    function hapusItem(index) { keranjang.splice(index, 1); updateKeranjang(); }
    function updateKeranjang() { const container = document.getElementById('cartItems'); if (keranjang.length === 0) { container.innerHTML = 'Tidak ada item.'; document.getElementById('btnSelesaikanTransaksi').classList.add('hidden'); } else { container.innerHTML = ''; keranjang.forEach((item, i) => { const div = document.createElement('div'); div.className = 'cart-item'; const hargaJual = parseInt(item.produk['Harga Jual']) || 0; const hargaMember = parseInt(item.produk['Harga Member']) || 0; const hargaEfektif = (isMemberActive && hargaMember > 0 && hargaMember < hargaJual) ? hargaMember : hargaJual; div.innerHTML = `<div>${item.produk['Nama Produk']} (${item.produk['Ukuran/Variasi']})<br><small>${item.qty} x Rp ${hargaEfektif.toLocaleString()}</small></div><div><strong>Rp ${(item.qty * hargaEfektif).toLocaleString()}</strong><button class="btn-remove" onclick="hapusItem(${i})">&times;</button></div>`; container.appendChild(div); }); document.getElementById('btnSelesaikanTransaksi').classList.remove('hidden'); } kalkulasiTotal(); }
    function terapkanDiskon() { const nomorHp = document.getElementById('memberId').value; const btn = document.getElementById('btnTerapkanDiskon'); if (!nomorHp) { alert('Masukkan nomor HP member.'); return; } btn.textContent = 'Mengecek...'; btn.disabled = true; google.script.run.withSuccessHandler(hasilCekMember).withFailureHandler(() => { alert('Gagal mengecek member.'); btn.textContent = 'Terapkan Diskon'; btn.disabled = false; }).cekMember(nomorHp); }
    function filterByCategory(jenis) { document.querySelectorAll('.category-btn').forEach(btn => { btn.classList.toggle('active', btn.textContent === jenis); }); currentPage = 1; updateProductView(); }
    function updateProductView() { const activeCategory = document.querySelector('.category-btn.active').textContent; const searchTerm = document.getElementById('searchInput').value.toLowerCase(); const allCards = document.querySelectorAll('.product-card'); const filteredCards = Array.from(allCards).filter(card => { const cardCategory = card.dataset.jenis; const cardText = card.innerText.toLowerCase(); const isCategoryMatch = (activeCategory === 'Semua' || cardCategory === activeCategory); const isSearchMatch = cardText.includes(searchTerm); return isCategoryMatch && isSearchMatch; }); allCards.forEach(card => card.style.display = 'none'); const totalPages = Math.ceil(filteredCards.length / itemsPerPage); const startIndex = (currentPage - 1) * itemsPerPage; const endIndex = startIndex + itemsPerPage; const pageCards = filteredCards.slice(startIndex, endIndex); pageCards.forEach(card => card.style.display = 'block'); updatePaginationControls(totalPages); }
    function updatePaginationControls(totalPages) { const controls = document.getElementById('paginationControls'); const prevBtn = document.getElementById('prevPageBtn'); const nextBtn = document.getElementById('nextPageBtn'); const pageInfo = document.getElementById('pageInfo'); if (totalPages > 1) { controls.classList.remove('hidden'); pageInfo.textContent = `Halaman ${currentPage} dari ${totalPages}`; prevBtn.disabled = (currentPage === 1); nextBtn.disabled = (currentPage === totalPages); } else { controls.classList.add('hidden'); } }
    function changePage(direction) { currentPage += direction; updateProductView(); }
    function tampilkanPembayaran() { if (keranjang.length === 0) { alert('Keranjang kosong.'); return; } const totalInfo = kalkulasiTotal(); document.getElementById('paymentTotalTagihan').textContent = `Rp ${totalInfo.totalAkhir.toLocaleString()}`; document.getElementById('keranjangCard').classList.add('hidden'); document.getElementById('paymentCard').classList.remove('hidden'); hitungKembalian(); }
    function batalPembayaran() { document.getElementById('paymentCard').classList.add('hidden'); document.getElementById('keranjangCard').classList.remove('hidden'); }
    function togglePaymentDetails() { const selectedMethod = document.querySelector('input[name="metodePembayaran"]:checked').value; document.getElementById('tunaiDetails').classList.toggle('hidden', selectedMethod !== 'Tunai'); document.getElementById('nonTunaiDetails').classList.toggle('hidden', selectedMethod === 'Tunai'); }
    function hitungKembalian() { const totalInfo = kalkulasiTotal(); const uangDiterima = parseInt(document.getElementById('uangDiterima').value) || 0; const kembalian = uangDiterima - totalInfo.totalAkhir; document.getElementById('kembalian').textContent = `Rp ${kembalian >= 0 ? kembalian.toLocaleString() : 0}`; }
    function onTransaksiSuccess(response) { if (response === "Sukses") { alert("Transaksi berhasil disimpan!"); document.getElementById('paymentCard').classList.add('hidden'); document.getElementById('postTransactionCard').classList.remove('hidden'); } else { alert("Gagal menyimpan transaksi: " + response); } const btnKonfirmasi = document.getElementById('btnKonfirmasiPembayaran'); btnKonfirmasi.disabled = false; btnKonfirmasi.textContent = 'Konfirmasi & Simpan'; }
    function onTransaksiFailure(error) { alert("Terjadi kesalahan saat menyimpan transaksi: " + error.message); const btnKonfirmasi = document.getElementById('btnKonfirmasiPembayaran'); btnKonfirmasi.disabled = false; btnKonfirmasi.textContent = 'Konfirmasi & Simpan'; }
    function cetakStruk() { window.print(); }
    function transaksiBaru() { document.getElementById('postTransactionCard').classList.add('hidden'); document.getElementById('keranjangCard').classList.remove('hidden'); resetKeranjang(); }
  </script>
</body>
</html>

